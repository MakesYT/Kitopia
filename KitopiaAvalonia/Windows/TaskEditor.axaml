<u:UrsaWindow xmlns="https://github.com/avaloniaui"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
              xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"

              xmlns:converter="clr-namespace:Kitopia.Converter"
              xmlns:pluginCore="clr-namespace:PluginCore;assembly=PluginCore"
              xmlns:controls1="clr-namespace:KitopiaAvalonia.Controls"
              xmlns:taskEditor="clr-namespace:Kitopia.Converter.TaskEditor"
              xmlns:customScenario="clr-namespace:Core.SDKs.CustomScenario;assembly=Core"

              xmlns:taskEditor1="clr-namespace:Core.ViewModel.TaskEditor;assembly=Core"

              xmlns:generic="clr-namespace:System.Collections.Generic;assembly=System.Runtime"
              xmlns:controls2="clr-namespace:NodifyM.Avalonia.Controls;assembly=NodifyM.Avalonia"
              xmlns:pages="clr-namespace:KitopiaAvalonia.Pages"
              xmlns:u="https://irihi.tech/ursa"
              xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls"
              xmlns:system="clr-namespace:System;assembly=System.Runtime"
              mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
              x:Class="KitopiaAvalonia.Windows.TaskEditor"
              Title="情景编排"
              WindowStartupLocation="CenterScreen"
              TransparencyLevelHint="AcrylicBlur"
              Name="TaskEditorWindow"
              x:DataType="taskEditor1:TaskEditorViewModel" Height="450" Width="1800">
    <u:UrsaWindow.Background>
        <SolidColorBrush Color="{DynamicResource SemiBackground0Color}" Opacity="0.65" />

    </u:UrsaWindow.Background>
    <u:UrsaWindow.Resources>

        <converter:HotKeySignNameToolCTr x:Key="HotKeySignNameToolCTr" />
        <taskEditor:IfNullVisibilityHidden x:Key="IfNullVisibilityHidden" />


        <converter:ReverseBool x:Key="ReverseBool" />
        <taskEditor:ScenarioMethodCategoryGroupCtr x:Key="ScenarioMethodCategoryGroupCtr" />
    </u:UrsaWindow.Resources>
    <u:UrsaWindow.Styles>

    </u:UrsaWindow.Styles>
    <Interaction.Behaviors>
        <EventTriggerBehavior EventName="Closing">
            <InvokeCommandAction Command="{Binding ReloadScenarioCommand}" PassEventArgsToCommand="True" />
        </EventTriggerBehavior>
        <EventTriggerBehavior EventName="DataContextChanged">
            <InvokeCommandAction Command="{Binding LoadCommand}"
                                 CommandParameter="{Binding #TaskEditorWindow}" />
        </EventTriggerBehavior>
        <EventTriggerBehavior EventName="Loaded">
            <InvokeCommandAction Command="{Binding LoadCommand}"
                                 CommandParameter="{Binding #TaskEditorWindow}" />
        </EventTriggerBehavior>
    </Interaction.Behaviors>

    <Grid Margin="0,40,0,0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="4*" />
            <ColumnDefinition Width="10" />
            <ColumnDefinition Width="11*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>


        <Button Grid.Row="0" Grid.Column="0" IsVisible="False" x:Name="add" Content="添加"
                Command="{Binding AddNodesCommand}" />
        <!-- 左边部分 -->
        <Border x:Name="border" Grid.Column="0" Padding="0,0,0,0" Margin="0">
            <ScrollViewer Margin="0" ScrollViewer.VerticalScrollBarVisibility="Auto" VerticalSnapPointsType="Mandatory">
                <ListBox x:Name="ListBox" Margin="3,0,0,0">

                    <ListBox.ItemContainerTheme>
                        <ControlTheme TargetType="ListBoxItem">
                            <Setter Property="Template">
                                <ControlTemplate>
                                    <ContentPresenter Name="PART_ContentPresenter"
                                                      HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                      VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                                      Background="{TemplateBinding Background}"
                                                      BorderBrush="{TemplateBinding BorderBrush}"
                                                      BorderThickness="{TemplateBinding BorderThickness}"
                                                      Content="{TemplateBinding Content}"
                                                      ContentTemplate="{TemplateBinding ContentTemplate}"
                                                      CornerRadius="{TemplateBinding CornerRadius}" />
                                </ControlTemplate>

                            </Setter>
                        </ControlTheme>
                    </ListBox.ItemContainerTheme>
                    <Expander Header="情景信息" IsExpanded="True" HorizontalContentAlignment="Stretch">
                        <Expander.Content>
                            <StackPanel HorizontalAlignment="Stretch">
                                <controls:SettingsExpander Header="情景名称">
                                    <controls:SettingsExpander.Footer>
                                        <TextBox MinWidth="80" Text="{Binding Scenario.Name}" />
                                    </controls:SettingsExpander.Footer>
                                    <controls:SettingsExpander.IconSource>
                                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                            Glyph="&#xf669;" />
                                    </controls:SettingsExpander.IconSource>
                                </controls:SettingsExpander>
                                <controls:SettingsExpander Margin="0" Header="情景描述">
                                    <controls:SettingsExpander.Footer>
                                        <TextBox TextWrapping="Wrap" MinWidth="80"
                                                 Text="{Binding Scenario.Description}" />
                                    </controls:SettingsExpander.Footer>
                                    <controls:SettingsExpander.IconSource>
                                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                            Glyph="&#xf4a3;" />
                                    </controls:SettingsExpander.IconSource>
                                </controls:SettingsExpander>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>

                    <controls:SettingsExpander Margin="0" Header="含有入参"
                                               BorderThickness="0">

                        <controls:SettingsExpander.Footer>
                            <ToggleSwitch
                                IsChecked="{Binding Scenario.IsHaveInputValue,Mode=TwoWay}" />
                        </controls:SettingsExpander.Footer>


                        <controls:SettingsExpander.IconSource>
                            <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                Glyph="&#xf226;" />
                        </controls:SettingsExpander.IconSource>
                        <StackPanel>
                            <ListBox Margin="0,0,10,0" x:Name="inputvalues"
                                     ItemsSource="{Binding Scenario.InputValue }">
                                <ListBox.ItemContainerTheme>
                                    <ControlTheme TargetType="ListBoxItem">
                                        <Setter Property="Template">
                                            <ControlTemplate>
                                                <ContentPresenter Name="PART_ContentPresenter"
                                                                  HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                  VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                  Background="{TemplateBinding Background}"
                                                                  BorderBrush="{TemplateBinding BorderBrush}"
                                                                  BorderThickness="{TemplateBinding BorderThickness}"
                                                                  Content="{TemplateBinding Content}"
                                                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                  DataContext="{TemplateBinding DataContext}"
                                                                  CornerRadius="{TemplateBinding CornerRadius}" />
                                            </ControlTemplate>

                                        </Setter>
                                    </ControlTheme>
                                </ListBox.ItemContainerTheme>
                                <ListBox.ItemTemplate>

                                    <DataTemplate>
                                        <Button Width="{Binding $parent.Bounds.Width, Mode=OneWay}"
                                                HorizontalContentAlignment="Stretch">
                                            <DockPanel Margin="15,0,0,0">
                                                <TextBlock VerticalAlignment="Center" Text="{ReflectionBinding Key}" />
                                                <Button Name="Button" Width="24" Height="24"
                                                        ToolTip.Tip="删除"
                                                        HorizontalAlignment="Right"
                                                        Command="{Binding $parent[StackPanel].((taskEditor1:TaskEditorViewModel)DataContext).DelInputValueCommand}"
                                                        CommandParameter="{ReflectionBinding Key}"
                                                        VerticalContentAlignment="Center"
                                                        HorizontalContentAlignment="Center">
                                                    <controls1:FontIcon VerticalAlignment="Center"
                                                                        HorizontalAlignment="Center"
                                                                        Margin="0,2,0,0"
                                                                        Width="24"
                                                                        Height="24"
                                                                        FontFamily="{StaticResource FluentFont}"
                                                                        Glyph="&#xf36a;"
                                                                        FontSize="24" />
                                                    <Button.Styles>

                                                        <Style
                                                            Selector="Button#Button:pointerover /template/ Border#Root">

                                                            <Setter Property="Background">
                                                                <SolidColorBrush
                                                                    Color="{DynamicResource SemiBackground4Color}"
                                                                    Opacity="0.2" />
                                                            </Setter>
                                                        </Style>

                                                    </Button.Styles>
                                                </Button>
                                            </DockPanel>
                                        </Button>

                                    </DataTemplate>


                                </ListBox.ItemTemplate>
                            </ListBox>
                            <TextBox Margin="0,5,0,0" Watermark="变量名称"
                                     Text="{Binding InputValueValue,Mode=TwoWay}">
                                <TextBox.InnerRightContent>
                                    <Button Command="{Binding AddInputValueCommand}"
                                            CommandParameter="{Binding InputValueValue}" Padding="2,3,0,0"
                                            Margin="3"
                                            Grid.Column="1">

                                        <controls1:FontIcon FontSize="24" HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" Foreground="GreenYellow"
                                                            Glyph="&#xf107;" />
                                    </Button>
                                </TextBox.InnerRightContent>
                            </TextBox>
                        </StackPanel>


                    </controls:SettingsExpander>


                    <Expander Header="Tick控制" IsExpanded="True">
                        <Expander.Content>
                            <StackPanel>
                                <controls:SettingsExpander Margin="0" Header="执行间隔(秒)">
                                    <controls:SettingsExpander.Footer>
                                        <u:NumericFloatUpDown
                                            Minimum="0.1"
                                            Value="{Binding Scenario.TickIntervalSecond}" />

                                    </controls:SettingsExpander.Footer>

                                    <controls:SettingsExpander.IconSource>
                                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                            Glyph="&#xed88;" />
                                    </controls:SettingsExpander.IconSource>
                                </controls:SettingsExpander>
                            </StackPanel>


                        </Expander.Content>
                    </Expander>

                    <Expander Header="变量" FontSize="15" IsExpanded="True" FontWeight="Medium">
                        <Expander.Content>
                            <StackPanel>
                                <ListBox Margin="0,0,10,0" x:Name="values"
                                         ItemsSource="{Binding Scenario.Values }">
                                    <ListBox.ItemContainerTheme>
                                        <ControlTheme TargetType="ListBoxItem">
                                            <Setter Property="Template">
                                                <ControlTemplate>
                                                    <ContentPresenter Name="PART_ContentPresenter"
                                                                      HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                      VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                      Background="{TemplateBinding Background}"
                                                                      BorderBrush="{TemplateBinding BorderBrush}"
                                                                      BorderThickness="{TemplateBinding BorderThickness}"
                                                                      Content="{TemplateBinding Content}"
                                                                      ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                      DataContext="{TemplateBinding DataContext}"
                                                                      CornerRadius="{TemplateBinding CornerRadius}" />
                                                </ControlTemplate>

                                            </Setter>
                                        </ControlTheme>
                                    </ListBox.ItemContainerTheme>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <Border BorderBrush="LightGray" BorderThickness="1"
                                                        CornerRadius="3"
                                                        Background="{DynamicResource SemiBackground4Color}">
                                                    <Border.ContextFlyout>
                                                        <MenuFlyout>
                                                            <!-- ReSharper disable once Xaml.RedundantResource -->
                                                            <MenuItem Header="删除此变量"
                                                                      Foreground="{DynamicResource SemiColorText0}"
                                                                      Command="{Binding $parent[StackPanel].((taskEditor1:TaskEditorViewModel)DataContext).DelValueCommand}"
                                                                      CommandParameter="{Binding Key }" />
                                                        </MenuFlyout>
                                                    </Border.ContextFlyout>

                                                    <Grid Margin="9">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="30" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <Border Tag="Set" PointerMoved="ListBox_OnMouseMove"
                                                                BorderBrush="LightGray" BorderThickness="1"
                                                                CornerRadius="3">
                                                            <DockPanel Panel.ZIndex="1">
                                                                <Border DockPanel.Dock="Top" CornerRadius="3 3 0 0">

                                                                    <Border Height="20"

                                                                            CornerRadius="3 3 0 0">
                                                                        <Border.Background>
                                                                            <SolidColorBrush Opacity="0.5"
                                                                                Color="{DynamicResource SemiBlue5Color}" />
                                                                        </Border.Background>
                                                                        <TextBlock HorizontalAlignment="Center"

                                                                            Text="{ReflectionBinding Key}"
                                                                            Foreground="White" />
                                                                    </Border>

                                                                </Border>
                                                                <Border CornerRadius="0 0 3 3">
                                                                    <Grid>
                                                                        <Rectangle>
                                                                            <Rectangle.Fill>
                                                                                <SolidColorBrush
                                                                                    Color="{DynamicResource Node.BackgroundColor}"
                                                                                    Opacity="0.5" />
                                                                            </Rectangle.Fill>
                                                                        </Rectangle>
                                                                        <DockPanel>
                                                                            <StackPanel Orientation="Vertical"
                                                                                DockPanel.Dock="Left"
                                                                                VerticalAlignment="Center">

                                                                                <StackPanel Orientation="Horizontal"
                                                                                    VerticalAlignment="Center">
                                                                                    <Border Background="Transparent">
                                                                                        <!-- Set the border color to red -->
                                                                                        <Border.BorderBrush>
                                                                                            <SolidColorBrush
                                                                                                Color="{DynamicResource SemiBlue5Color}"
                                                                                                Opacity="0.5" />
                                                                                        </Border.BorderBrush>
                                                                                        <!-- Set the border thickness to 2 -->
                                                                                        <Border.BorderThickness>2</Border.BorderThickness>
                                                                                        <!-- Set the border corner radius to 10 -->
                                                                                        <Border.CornerRadius>10</Border.CornerRadius>
                                                                                        <!-- Set the padding to 10 -->
                                                                                        <Border.Padding>5</Border.Padding>
                                                                                        <!-- Set the margin to 20 -->
                                                                                        <Border.Margin>5</Border.Margin>
                                                                                    </Border>
                                                                                    <!-- Declare a TextBlock element and give it a name -->

                                                                                    <TextBlock
                                                                                        VerticalAlignment="Center"
                                                                                        x:Name="textBlock"
                                                                                        FontSize="12"
                                                                                        Background="{DynamicResource SemiColorText0}"
                                                                                        Foreground="{DynamicResource SemiBackground4Color}"
                                                                                        Text="节点">


                                                                                    </TextBlock>


                                                                                    <TextBlock
                                                                                        VerticalAlignment="Center"
                                                                                        Foreground="{DynamicResource SemiColorText0}"
                                                                                        Text="流节点">
                                                                                    </TextBlock>
                                                                                </StackPanel>
                                                                                <StackPanel Orientation="Horizontal"
                                                                                    VerticalAlignment="Center">
                                                                                    <Border Background="Transparent">
                                                                                        <!-- Set the border color to red -->
                                                                                        <Border.BorderBrush>
                                                                                            <SolidColorBrush
                                                                                                Color="{DynamicResource SemiBlue5Color}"
                                                                                                Opacity="0.5" />
                                                                                        </Border.BorderBrush>
                                                                                        <!-- Set the border thickness to 2 -->
                                                                                        <Border.BorderThickness>2</Border.BorderThickness>
                                                                                        <!-- Set the border corner radius to 10 -->
                                                                                        <Border.CornerRadius>10</Border.CornerRadius>
                                                                                        <!-- Set the padding to 10 -->
                                                                                        <Border.Padding>5</Border.Padding>
                                                                                        <!-- Set the margin to 20 -->
                                                                                        <Border.Margin>5</Border.Margin>
                                                                                    </Border>
                                                                                    <!-- Declare a TextBlock element and give it a name -->

                                                                                    <TextBlock
                                                                                        VerticalAlignment="Center"
                                                                                        FontSize="12"
                                                                                        Background="{DynamicResource SemiColorText0}"
                                                                                        Foreground="{DynamicResource SemiBackground4Color}"
                                                                                        Text="变量">

                                                                                    </TextBlock>


                                                                                    <TextBlock
                                                                                        VerticalAlignment="Center"
                                                                                        Foreground="{DynamicResource SemiColorText0}"
                                                                                        Text="设置">
                                                                                    </TextBlock>
                                                                                </StackPanel>
                                                                            </StackPanel>


                                                                        </DockPanel>
                                                                    </Grid>
                                                                </Border>


                                                            </DockPanel>
                                                        </Border>
                                                        <Border Tag="Get" PointerMoved="ListBox_OnMouseMove"
                                                                Grid.Column="2"
                                                                BorderBrush="LightGray" BorderThickness="1"
                                                                CornerRadius="3">
                                                            <DockPanel Panel.ZIndex="1">
                                                                <Border DockPanel.Dock="Top" CornerRadius="3 3 0 0">

                                                                    <Border Height="20"

                                                                            CornerRadius="3 3 0 0">
                                                                        <Border.Background>
                                                                            <SolidColorBrush Opacity="0.5"
                                                                                Color="{DynamicResource SemiBlue5Color}" />
                                                                        </Border.Background>
                                                                        <TextBlock HorizontalAlignment="Center"

                                                                            Text="{ReflectionBinding Key }"
                                                                            Foreground="White" />
                                                                    </Border>

                                                                </Border>
                                                                <Border CornerRadius="0 0 3 3">
                                                                    <Grid>
                                                                        <Rectangle>
                                                                            <Rectangle.Fill>
                                                                                <SolidColorBrush
                                                                                    Color="{DynamicResource Node.BackgroundColor}"
                                                                                    Opacity="0.5" />
                                                                            </Rectangle.Fill>
                                                                        </Rectangle>
                                                                        <StackPanel Orientation="Horizontal"
                                                                            VerticalAlignment="Center"
                                                                            HorizontalAlignment="Right">

                                                                            <TextBlock
                                                                                VerticalAlignment="Center"
                                                                                Foreground="{DynamicResource SemiColorText0}"
                                                                                Text="读取">

                                                                            </TextBlock>
                                                                            <TextBlock
                                                                                VerticalAlignment="Center"
                                                                                FontSize="12"
                                                                                Background="{DynamicResource SemiColorText0}"
                                                                                Foreground="{DynamicResource SemiBackground4Color}"
                                                                                Text="变量">

                                                                            </TextBlock>

                                                                            <Border Background="Transparent">
                                                                                <!-- Set the border color to red -->
                                                                                <Border.BorderBrush>
                                                                                    <SolidColorBrush
                                                                                        Color="{DynamicResource SemiBlue5Color}"
                                                                                        Opacity="0.5" />
                                                                                </Border.BorderBrush>
                                                                                <!-- Set the border thickness to 2 -->
                                                                                <Border.BorderThickness>2</Border.BorderThickness>
                                                                                <!-- Set the border corner radius to 10 -->
                                                                                <Border.CornerRadius>10</Border.CornerRadius>
                                                                                <!-- Set the padding to 10 -->
                                                                                <Border.Padding>5</Border.Padding>
                                                                                <!-- Set the margin to 20 -->
                                                                                <Border.Margin>5</Border.Margin>
                                                                            </Border>
                                                                            <!-- Declare a TextBlock element and give it a name -->

                                                                        </StackPanel>


                                                                    </Grid>
                                                                </Border>


                                                            </DockPanel>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </Grid>


                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <TextBox Margin="0,5,0,0" Watermark="变量名称"
                                         Text="{Binding ValueValue,Mode=TwoWay}">
                                    <TextBox.InnerRightContent>
                                        <Button Command="{Binding AddValueCommand}"
                                                CommandParameter="{Binding ValueValue}" Padding="2,3,0,0"
                                                Margin="3"
                                                Grid.Column="1">

                                            <controls1:FontIcon FontSize="24" HorizontalAlignment="Center"
                                                                VerticalAlignment="Center" Foreground="GreenYellow"
                                                                Glyph="&#xf107;" />
                                        </Button>
                                    </TextBox.InnerRightContent>
                                </TextBox>

                            </StackPanel>


                        </Expander.Content>
                    </Expander>
                    <Expander Header="触发条件" IsExpanded="True">
                        <Expander.Content>

                            <StackPanel>

                                <controls:SettingsExpander Margin="0" Header="手动触发"
                                                           BorderThickness="0">
                                    <controls:SettingsExpander.Footer>
                                        <ToggleSwitch
                                            IsChecked="{Binding Scenario.ExecutionManual,Mode=TwoWay}" />
                                    </controls:SettingsExpander.Footer>


                                    <controls:SettingsExpander.IconSource>
                                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                            Glyph="&#xf226;" />
                                    </controls:SettingsExpander.IconSource>
                                    <StackPanel>
                                        <controls:SettingsExpander Margin="0" Header="关键词"
                                                                   BorderThickness="0">
                                            <controls:SettingsExpander.IconSource>
                                                <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                                    Glyph="&#xf4b6;" />
                                            </controls:SettingsExpander.IconSource>
                                            <controls1:ListShow AddCommand="{Binding AddKeyCommand}"
                                                                DelCommand="{Binding DelKeyCommand}"
                                                                ItemsSource="{Binding Scenario.Keys}" WithAdd="True">

                                            </controls1:ListShow>

                                        </controls:SettingsExpander>


                                    </StackPanel>

                                </controls:SettingsExpander>
                                <controls:SettingsExpander Margin="0" Header="自动触发"
                                                           BorderThickness="0">

                                    <controls:SettingsExpander.IconSource>
                                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                            Glyph="&#xf217;" />
                                    </controls:SettingsExpander.IconSource>

                                    <ItemsControl Margin="15,0,0,0"
                                                  ItemsSource="{Binding Source={x:Static customScenario:CustomScenarioGloble.Triggers}}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <DataTemplate.DataType>
                                                    <x:Type TypeName="generic:KeyValuePair"
                                                            x:TypeArguments="x:String, pluginCore:CustomScenarioTriggerInfo" />
                                                </DataTemplate.DataType>
                                                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                    <StackPanel.Resources>
                                                        <taskEditor:AutoTriggersCtr x:Key="AutoTriggersCtr" />
                                                    </StackPanel.Resources>
                                                    <CheckBox
                                                        IsChecked="{Binding Path=$parent[Expander].((taskEditor1:TaskEditorViewModel)DataContext).Scenario,Converter={StaticResource AutoTriggersCtr},
                                                              ConverterParameter={Binding .}}" />
                                                    <TextBlock VerticalAlignment="Center"
                                                               Text="{Binding Value.Name}">
                                                    </TextBlock>

                                                    <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                                        Glyph="&#xf4a3;"
                                                                        ToolTip.Tip="{Binding Value.Description}"
                                                                        ToolTip.ShowDelay="0"
                                                                        IsVisible="{Binding Value.Description, Converter={StaticResource IfNullVisibilityHidden}}" />
                                                </StackPanel>
                                            </DataTemplate>

                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                </controls:SettingsExpander>
                                <controls:SettingsExpander Margin="0" Header="快捷键触发"
                                                           BorderThickness="0">
                                    <controls:SettingsExpander.IconSource>
                                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                            Glyph="&#xf4b8;" />
                                    </controls:SettingsExpander.IconSource>
                                    <StackPanel Margin="0" Orientation="Vertical">
                                        <controls:SettingsExpander Header="激活快捷键" Description="修改激活快捷键">
                                            <controls:SettingsExpander.Footer>
                                                <Panel>
                                                    <u:DisableContainer DisabledTip="需要先保存一次情景才可设置"
                                                                        ToolTip.ShowDelay="100">
                                                        <controls1:HotKeyShow
                                                            HotKeyModel="{Binding Scenario.RunHotKey}"
                                                            IsEnabled="{Binding IsSaveInLocal}">
                                                        </controls1:HotKeyShow>
                                                    </u:DisableContainer>

                                                </Panel>


                                            </controls:SettingsExpander.Footer>

                                            <controls:SettingsExpander.IconSource>
                                                <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                                    Glyph="&#xf4b8;" />
                                            </controls:SettingsExpander.IconSource>
                                        </controls:SettingsExpander>
                                        <controls:SettingsExpander Header="停止快捷键" Description="修改停止快捷键">
                                            <controls:SettingsExpander.Footer>
                                                <Panel>
                                                    <u:DisableContainer DisabledTip="需要先保存一次情景才可设置"
                                                                        ToolTip.ShowDelay="100">
                                                        <controls1:HotKeyShow
                                                            HotKeyModel="{Binding Scenario.StopHotKey}"
                                                            IsEnabled="{Binding IsSaveInLocal}">
                                                        </controls1:HotKeyShow>
                                                    </u:DisableContainer>
                                                </Panel>
                                            </controls:SettingsExpander.Footer>

                                            <controls:SettingsExpander.IconSource>
                                                <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                                    Glyph="&#xf4b8;" />
                                            </controls:SettingsExpander.IconSource>
                                        </controls:SettingsExpander>
                                    </StackPanel>
                                </controls:SettingsExpander>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>
                    <ContentPresenter x:Name="ContentPresenter">
                        <ContentPresenter.Resources>
                            <taskEditor:InterfacesToString x:Key="InterfacesToString" />
                            <DataTemplate x:Key="DataTemplate" DataType="{x:Type customScenario:ScenarioMethodNode}">
                                <Border Tag="Node" BorderBrush="LightGray" BorderThickness="1" CornerRadius="3"
                                        PointerMoved="ListBox_OnMouseMove">
                                    <DockPanel Panel.ZIndex="1">
                                        <Border DockPanel.Dock="Top" CornerRadius="3 3 0 0">

                                            <Border Height="20"

                                                    CornerRadius="3 3 0 0">
                                                <Border.Background>
                                                    <SolidColorBrush Opacity="0.5"
                                                                     Color="{DynamicResource SemiBlue5Color}" />
                                                </Border.Background>
                                                <TextBlock HorizontalAlignment="Center"
                                                           Text="{Binding Title}"
                                                           Foreground="White" />
                                            </Border>

                                        </Border>
                                        <Border CornerRadius="0 0 3 3">
                                            <Grid>
                                                <Rectangle>
                                                    <Rectangle.Fill>
                                                        <SolidColorBrush
                                                            Color="{DynamicResource Node.BackgroundColor}"
                                                            Opacity="0.5" />
                                                    </Rectangle.Fill>
                                                </Rectangle>
                                                <DockPanel>
                                                    <ItemsControl DockPanel.Dock="Left"
                                                                  ItemsSource="{Binding Input}">
                                                        <!-- Set the ItemsPanel to a StackPanel with horizontal orientation -->
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <StackPanel Orientation="Vertical"
                                                                            VerticalAlignment="Center" />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <!-- Set the ItemTemplate to a Button with the content bound to the item -->
                                                        <ItemsControl.ItemTemplate>
                                                            <pages:MyDataTemplateSelector>
                                                                <DataTemplate x:Key="InputTemplate"
                                                                              DataType="{x:Type customScenario:ConnectorItem}">

                                                                    <StackPanel
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center">
                                                                        <Border
                                                                            Background="Transparent">
                                                                            <!-- Set the border color to red -->
                                                                            <Border.BorderBrush>
                                                                                <SolidColorBrush
                                                                                    Color="{DynamicResource SemiBlue5Color}"
                                                                                    Opacity="0.5" />
                                                                            </Border.BorderBrush>
                                                                            <!-- Set the border thickness to 2 -->
                                                                            <Border.BorderThickness>2</Border.BorderThickness>
                                                                            <!-- Set the border corner radius to 10 -->
                                                                            <Border.CornerRadius>10</Border.CornerRadius>
                                                                            <!-- Set the padding to 10 -->
                                                                            <Border.Padding>5</Border.Padding>
                                                                            <!-- Set the margin to 20 -->
                                                                            <Border.Margin>5</Border.Margin>
                                                                        </Border>
                                                                        <!-- Declare a TextBlock element and give it a name -->

                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            FontSize="12"
                                                                            Background="{DynamicResource SemiColorText0}"
                                                                            Foreground="{DynamicResource SemiBackground4Color}"
                                                                            Text="{Binding TypeName}">

                                                                        </TextBlock>


                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            Foreground="{DynamicResource SemiColorText0}"
                                                                            Text="{Binding Title}">
                                                                        </TextBlock>
                                                                    </StackPanel>


                                                                </DataTemplate>
                                                                <DataTemplate x:Key="StringTemplate"
                                                                              DataType="{x:Type customScenario:ConnectorItem}">
                                                                    <StackPanel Margin="10,0,0,0"
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right">
                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            Text="{Binding Title}"
                                                                            Foreground="{DynamicResource SemiColorText0}" />
                                                                        <TextBox Margin="10,5,10,5"
                                                                            MinWidth="40"
                                                                            Text="{Binding InputObject}"
                                                                            Watermark="字符串" />
                                                                    </StackPanel>

                                                                </DataTemplate>
                                                                <DataTemplate x:Key="EnumTemplate"
                                                                              DataType="{x:Type customScenario:ConnectorItem}">
                                                                    <StackPanel Margin="10,0,0,0"
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right">
                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            Text="{Binding Title}"
                                                                            Foreground="{DynamicResource SemiColorText0}" />
                                                                        <ComboBox Margin="10,5,10,5"
                                                                            x:Name="ComboBox"
                                                                            MinWidth="40"
                                                                            SelectedValue="{Binding InputObject,Mode=TwoWay}" />
                                                                    </StackPanel>

                                                                </DataTemplate>
                                                                <DataTemplate x:Key="IntTemplate"
                                                                              DataType="{x:Type customScenario:ConnectorItem}">
                                                                    <StackPanel Margin="10,0,0,0"
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right">
                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            Text="{Binding Title}"
                                                                            Foreground="{DynamicResource SemiColorText0}" />
                                                                        <u:NumericIntUpDown
                                                                            Margin="10,5,10,5"
                                                                            MinWidth="40"
                                                                            Maximum="2147483647"
                                                                            Minimum="-2147483648"
                                                                            Value="{Binding InputObject, Mode=TwoWay}"
                                                                            Watermark="整型" />
                                                                    </StackPanel>

                                                                </DataTemplate>
                                                                <DataTemplate x:Key="DoubleTemplate"
                                                                              DataType="{x:Type customScenario:ConnectorItem}">
                                                                    <StackPanel Margin="10,0,0,0"
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right">
                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            Text="{Binding Title}"
                                                                            Foreground="{DynamicResource SemiColorText0}" />
                                                                        <u:NumericDoubleUpDown
                                                                            Margin="10,5,10,5"
                                                                            MinWidth="40"
                                                                            Value="{Binding InputObject, Mode=TwoWay}"
                                                                            Watermark="浮点" />
                                                                    </StackPanel>

                                                                </DataTemplate>
                                                                <DataTemplate x:Key="BoolTemplate"
                                                                              DataType="{x:Type customScenario:ConnectorItem}">
                                                                    <StackPanel Margin="10,0,0,0"
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right">
                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            Text="{Binding Title}"
                                                                            Foreground="{DynamicResource SemiColorText0}" />
                                                                        <ToggleSwitch
                                                                            Margin="10,5,10,5"
                                                                            MinWidth="40"
                                                                            IsChecked="{Binding InputObject, Mode=TwoWay}" />
                                                                    </StackPanel>

                                                                </DataTemplate>
                                                                <DataTemplate
                                                                    x:Key="SearchItemTemplate"
                                                                    DataType="{x:Type customScenario:ConnectorItem}">
                                                                    <StackPanel Margin="10,0,0,0"
                                                                        Orientation="Horizontal"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right">
                                                                        <TextBlock
                                                                            VerticalAlignment="Center"
                                                                            x:Name="textBlock"
                                                                            Text="{Binding Title}"
                                                                            Foreground="{DynamicResource SemiColorText0}" />
                                                                        <controls1:SearchItemShow
                                                                            Margin="10,5,10,5"
                                                                            ToolTip.Tip="{Binding RelativeSource={RelativeSource Self},Path=OnlyKey}"
                                                                            Click="SearchItemShow_OnClick"
                                                                            OnlyKey="{Binding InputObject, Mode=TwoWay}" />
                                                                    </StackPanel>

                                                                </DataTemplate>

                                                            </pages:MyDataTemplateSelector>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>


                                                    <ItemsControl DockPanel.Dock="Right"
                                                                  VerticalAlignment="Center"
                                                                  ItemsSource="{Binding Output}">
                                                        <!-- Set the ItemsPanel to a StackPanel with horizontal orientation -->
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <StackPanel Orientation="Vertical"
                                                                            HorizontalAlignment="Right" />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <!-- Set the ItemTemplate to a Button with the content bound to the item -->
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Orientation="Horizontal"
                                                                            VerticalAlignment="Center"
                                                                            HorizontalAlignment="Right">

                                                                    <TextBlock
                                                                        VerticalAlignment="Center"
                                                                        x:Name="textBlock"
                                                                        Foreground="{DynamicResource SemiColorText0}"
                                                                        Text="{Binding Title}">
                                                                    </TextBlock>
                                                                    <TextBlock
                                                                        VerticalAlignment="Center"
                                                                        FontSize="12"
                                                                        Background="{DynamicResource SemiColorText0}"
                                                                        Foreground="{DynamicResource SemiBackground4Color}"
                                                                        Text="{Binding TypeName}">
                                                                    </TextBlock>
                                                                    <controls1:FontIcon
                                                                        FontFamily="{StaticResource FluentFont}"
                                                                        Glyph="&#xf10c;"
                                                                        ToolTip.Tip="{Binding Interfaces, Converter={StaticResource InterfacesToString}}"
                                                                        ToolTip.ShowDelay="0"
                                                                        IsVisible="{Binding Interfaces, Converter={StaticResource IfNullVisibilityHidden}}" />
                                                                    <Border Background="Transparent">
                                                                        <!-- Set the border color to red -->
                                                                        <Border.BorderBrush>
                                                                            <SolidColorBrush
                                                                                Color="{DynamicResource SemiBlue5Color}"
                                                                                Opacity="0.5" />
                                                                        </Border.BorderBrush>
                                                                        <!-- Set the border thickness to 2 -->
                                                                        <Border.BorderThickness>2</Border.BorderThickness>
                                                                        <!-- Set the border corner radius to 10 -->
                                                                        <Border.CornerRadius>10</Border.CornerRadius>
                                                                        <!-- Set the padding to 10 -->
                                                                        <Border.Padding>5</Border.Padding>
                                                                        <!-- Set the margin to 20 -->
                                                                        <Border.Margin>5</Border.Margin>
                                                                    </Border>
                                                                    <!-- Declare a TextBlock element and give it a name -->

                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </DockPanel>
                                            </Grid>
                                        </Border>


                                    </DockPanel>
                                </Border>


                            </DataTemplate>
                        </ContentPresenter.Resources>
                        <ContentPresenter.Content>
                            <Binding
                                Path="ScenarioMethodCategoryGroup"
                                Converter="{StaticResource ScenarioMethodCategoryGroupCtr}"
                                ConverterParameter="{Binding #ContentPresenter}" UpdateSourceTrigger="PropertyChanged">
                            </Binding>
                        </ContentPresenter.Content>
                    </ContentPresenter>


                </ListBox>
            </ScrollViewer>

        </Border>
        <!-- 拖动部分 -->
        <GridSplitter Grid.Row="0" Grid.Column="1" Grid.RowSpan="2" Width="5" HorizontalAlignment="Center"
                      VerticalAlignment="Stretch" />
        <!-- 右边部分 -->
        <Border Grid.Column="2">
            <Grid ShowGridLines="True">
                <Grid Panel.ZIndex="-2">
                    <Grid.Background>
                        <SolidColorBrush Color="{DynamicResource NodifyEditor.BackgroundColor}" Opacity="0.5" />
                    </Grid.Background>
                </Grid>
                <controls2:NodifyEditor x:Name="Editor"
                                        d:DataContext="{}"
                                        DragDrop.AllowDrop="True"
                                        PendingConnection="{Binding PendingConnection}"
                                        DisconnectConnectorCommand="{Binding DisconnectConnectorCommand}"
                                        Connections="{Binding Scenario.connections}"
                                        ItemsSource="{Binding Scenario.nodes}">
                    <controls2:NodifyEditor.Resources>
                        <taskEditor:NodeStatusBorderCtr x:Key="NodeStatusBorderCtr" />
                    </controls2:NodifyEditor.Resources>
                    <controls2:NodifyEditor.GridLineTemplate>
                        <DataTemplate>
                            <controls2:LargeGridLine
                                Width="{Binding $parent[controls2:NodifyEditor].Bounds.Width}"
                                OffsetX="{Binding $parent[controls2:NodifyEditor].OffsetX}"
                                OffsetY="{Binding $parent[controls2:NodifyEditor].OffsetY}"
                                Zoom="{Binding $parent[controls2:NodifyEditor].Zoom}"
                                Height="{Binding $parent[controls2:NodifyEditor].Bounds.Height}"
                                ZIndex="-2">
                                <controls2:LargeGridLine.Brush>
                                    <SolidColorBrush Color="Gainsboro" Opacity="0.5" />
                                </controls2:LargeGridLine.Brush>
                            </controls2:LargeGridLine>
                        </DataTemplate>
                    </controls2:NodifyEditor.GridLineTemplate>


                    <controls2:NodifyEditor.ConnectionTemplate>
                        <DataTemplate DataType="{x:Type customScenario:ConnectionItem}">
                            <Grid>
                                <controls2:Connection Source="{Binding Source.Anchor}" Focusable="True"
                                                      Target="{Binding Target.Anchor}">
                                    <controls2:Connection.ContextFlyout>
                                        <MenuFlyout>
                                            <!-- ReSharper disable once Xaml.RedundantResource -->
                                            <MenuItem Header="删除此连接"
                                                      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                                      Command="{Binding $parent[Window].((taskEditor1:TaskEditorViewModel)DataContext).DelConnectionCommand}"
                                                      CommandParameter="{Binding }" />
                                        </MenuFlyout>
                                    </controls2:Connection.ContextFlyout>
                                    <controls2:Connection.Stroke>
                                        <SolidColorBrush Color="{DynamicResource SemiBlue5Color}"
                                                         Opacity="0.5" />
                                    </controls2:Connection.Stroke>
                                </controls2:Connection>
                            </Grid>

                        </DataTemplate>
                    </controls2:NodifyEditor.ConnectionTemplate>

                    <controls2:NodifyEditor.PendingConnectionTemplate>
                        <DataTemplate DataType="{x:Type taskEditor1:PendingConnectionViewModel}">
                            <controls2:PendingConnection StartedCommand="{Binding StartCommand}"
                                                         CompletedCommand="{Binding FinishCommand}"
                                                         EnablePreview="True"
                                                         EnableSnapping="True"

                                                         PreviewTarget="{Binding PreviewTarget, Mode=TwoWay}">
                                <controls2:PendingConnection.Stroke>
                                    <SolidColorBrush Color="{DynamicResource SemiBlue5Color}"
                                                     Opacity="0.5" />
                                </controls2:PendingConnection.Stroke>
                                <controls2:PendingConnection.Background>
                                    <SolidColorBrush Color="{DynamicResource SemiBlue5Color}"
                                                     Opacity="0.8" />
                                </controls2:PendingConnection.Background>
                                <TextBlock Text="{Binding PreviewText}" />
                            </controls2:PendingConnection>

                        </DataTemplate>
                    </controls2:NodifyEditor.PendingConnectionTemplate>
                    <controls2:NodifyEditor.ItemTemplate>
                        <DataTemplate DataType="{x:Type customScenario:ScenarioMethodNode}">
                            <controls2:Node
                                Classes.Status0="{Binding  Status, Converter={StaticResource NodeStatusBorderCtr},ConverterParameter=0}"
                                Classes.Status1="{Binding  Status, Converter={StaticResource NodeStatusBorderCtr},ConverterParameter=1}"
                                Classes.Status2="{Binding  Status, Converter={StaticResource NodeStatusBorderCtr},ConverterParameter=2}"
                                Classes.Status3="{Binding  Status, Converter={StaticResource NodeStatusBorderCtr},ConverterParameter=3}"
                                x:Name="Node"
                                Input="{Binding Input}"
                                Location="{Binding Location,Mode=TwoWay}"
                                VerticalAlignment="Center"
                                Output="{Binding Output}">
                                <controls2:Node.ContextFlyout>
                                    <MenuFlyout>
                                        <!-- ReSharper disable once Xaml.RedundantResource -->
                                        <MenuItem Header="复制节点"
                                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                                  Command="{Binding $parent[Grid].((taskEditor1:TaskEditorViewModel)DataContext).CopyNodeCommand}"
                                                  CommandParameter="{Binding }" />
                                        <!-- ReSharper disable once Xaml.RedundantResource -->
                                        <MenuItem Header="删除此节点"
                                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                                  Command="{Binding $parent[Grid].((taskEditor1:TaskEditorViewModel)DataContext).DelNodeCommand}"
                                                  CommandParameter="{Binding }" />

                                    </MenuFlyout>
                                </controls2:Node.ContextFlyout>
                                <controls2:Node.Styles>
                                    <Style Selector="controls2|Node.Status0">
                                        <Setter Property="BorderBrush" Value="LightGray" />
                                    </Style>
                                    <Style Selector="controls2|Node.Status1">
                                        <Setter Property="BorderBrush" Value="GreenYellow" />
                                    </Style>
                                    <Style Selector="controls2|Node.Status2">
                                        <Setter Property="BorderBrush" Value="OrangeRed" />
                                    </Style>
                                    <Style Selector="controls2|Node.Status3">
                                        <Setter Property="BorderBrush" Value="Yellow" />
                                    </Style>
                                </controls2:Node.Styles>
                                <controls2:Node.Resources>

                                    <taskEditor:InterfacesToString x:Key="InterfacesToString" />


                                </controls2:Node.Resources>


                                <controls2:Node.HeaderBrush>
                                    <SolidColorBrush Color="{DynamicResource SemiBlue5Color}"
                                                     Opacity="0.5" />
                                </controls2:Node.HeaderBrush>
                                <controls2:Node.Header>
                                    <TextBlock Text="{Binding Title}" Foreground="White"
                                               HorizontalAlignment="Center" />
                                </controls2:Node.Header>
                                <controls2:Node.InputConnectorTemplate>
                                    <DataTemplate DataType="{x:Type customScenario:ConnectorItem}">
                                        <ContentPresenter Content="{Binding .}" Name="ContentPresenter1">
                                            <ContentPresenter.ContextFlyout>
                                                <MenuFlyout>
                                                    <!-- ReSharper disable once Xaml.RedundantResource -->
                                                    <MenuItem Header="切换自输入/连接器"
                                                              Foreground="{DynamicResource SemiColorText0}"
                                                              Command="{Binding $parent[controls2:NodifyEditor].((taskEditor1:TaskEditorViewModel)DataContext).SwitchConnectorCommand}"
                                                              CommandParameter="{Binding #ContentPresenter1  }" />
                                                </MenuFlyout>
                                            </ContentPresenter.ContextFlyout>
                                            <ContentPresenter.DataTemplates>
                                                <pages:MyDataTemplateSelector>
                                                    <DataTemplate x:Key="InputTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <controls2:NodeInput
                                                            ToolTip.Tip="{Binding InputObject}"
                                                            ToolTip.ShowDelay="0"
                                                            IsConnected="{Binding IsConnected}"
                                                            Anchor="{Binding Anchor, Mode=TwoWay}">
                                                            <controls2:NodeInput.Header>

                                                                <StackPanel Orientation="Horizontal"
                                                                            VerticalAlignment="Center"
                                                                            HorizontalAlignment="Right">
                                                                    <StackPanel.Styles>
                                                                        <Style
                                                                            Selector="TextBlock#TypeNametextBlock">
                                                                            <Setter Property="Background"
                                                                                Value="{DynamicResource SemiColorText0}">

                                                                            </Setter>
                                                                            <Setter Property="Foreground">
                                                                                <Setter.Value>
                                                                                    <SolidColorBrush
                                                                                        Color="{DynamicResource SemiBackground0Color}" />
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </Style>
                                                                        <Style Selector="TextBlock.IsNotUsed">
                                                                            <Setter Property="Background">
                                                                                <Setter.Value>
                                                                                    <SolidColorBrush
                                                                                        Color="{DynamicResource SemiGrey1Color}"
                                                                                        Opacity="0.6" />
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                            <Setter Property="Foreground">
                                                                                <Setter.Value>
                                                                                    <SolidColorBrush
                                                                                        Color="{DynamicResource SemiBackground0Color}" />
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </Style>
                                                                    </StackPanel.Styles>
                                                                    <TextBlock VerticalAlignment="Center"
                                                                               FontSize="12"
                                                                               x:Name="TypeNametextBlock"
                                                                               Classes.IsNotUsed="{Binding IsNotUsed}"
                                                                               Text="{Binding TypeName}" />
                                                                    <TextBlock VerticalAlignment="Center"
                                                                               x:Name="textBlock"
                                                                               Classes.IsNotUsed="{Binding IsNotUsed}"
                                                                               Text="{Binding Title}" />
                                                                </StackPanel>
                                                            </controls2:NodeInput.Header>
                                                            <controls2:NodeInput.BorderBrush>
                                                                <SolidColorBrush
                                                                    Color="{DynamicResource SemiBlue5Color}"
                                                                    Opacity="0.5" />
                                                            </controls2:NodeInput.BorderBrush>
                                                        </controls2:NodeInput>
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="StringTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <StackPanel Margin="10,0,0,0" Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    IsHitTestVisible="True"

                                                                    HorizontalAlignment="Right">
                                                            <TextBlock VerticalAlignment="Center"
                                                                       x:Name="textBlock"
                                                                       Text="{Binding Title}"
                                                                       Foreground="{DynamicResource SemiColorText0}" />
                                                            <TextBox Margin="10,5,10,5" MinWidth="40"
                                                                     Foreground="{DynamicResource SemiColorText0}"
                                                                     Text="{Binding InputObject}" Watermark="字符串" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                    <DataTemplate x:Key="EnumTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <StackPanel Margin="10,0,0,0"
                                                                    Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    HorizontalAlignment="Right">
                                                            <TextBlock
                                                                VerticalAlignment="Center"
                                                                x:Name="textBlock"
                                                                Text="{Binding Title}"
                                                                Foreground="{DynamicResource SemiColorText0}" />
                                                            <ComboBox Margin="10,5,10,5" x:Name="ComboBox"
                                                                      MinWidth="40"
                                                                      SelectedValue="{Binding InputObject,Mode=TwoWay}">
                                                                <ComboBox.DataTemplates>
                                                                    <DataTemplate DataType="system:Object">
                                                                        <TextBlock Text="{Binding}"
                                                                            Foreground="{DynamicResource SemiColorText0}">
                                                                        </TextBlock>
                                                                    </DataTemplate>
                                                                </ComboBox.DataTemplates>
                                                                <ComboBox.Styles>
                                                                    <Style
                                                                        Selector="ComboBox /template/ ContentPresenter#ContentPresenter">
                                                                        <Setter Property="ContentTemplate">
                                                                            <Setter.Value>
                                                                                <DataTemplate DataType="system:Object">
                                                                                    <TextBlock Text="{Binding}"
                                                                                        Foreground="{DynamicResource SemiColorText0}">
                                                                                    </TextBlock>
                                                                                </DataTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </ComboBox.Styles>
                                                            </ComboBox>

                                                        </StackPanel>

                                                    </DataTemplate>
                                                    <DataTemplate x:Key="IntTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <StackPanel Margin="10,0,0,0" Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    HorizontalAlignment="Right">
                                                            <TextBlock VerticalAlignment="Center"
                                                                       x:Name="textBlock"
                                                                       Text="{Binding Title}"
                                                                       Foreground="{DynamicResource SemiColorText0}" />
                                                            <u:NumericIntUpDown Margin="10,5,10,5" MinWidth="40"

                                                                Maximum="2147483647" Minimum="-2147483648"
                                                                Foreground="{DynamicResource SemiColorText0}"
                                                                Value="{Binding InputObject, Mode=TwoWay }"
                                                                Watermark="整型" />
                                                        </StackPanel>

                                                    </DataTemplate>
                                                    <DataTemplate x:Key="DoubleTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <StackPanel Margin="10,0,0,0" Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    HorizontalAlignment="Right">
                                                            <TextBlock VerticalAlignment="Center"
                                                                       x:Name="textBlock"
                                                                       Text="{Binding Title}"
                                                                       Foreground="{DynamicResource SemiColorText0}" />
                                                            <u:NumericDoubleUpDown Margin="10,5,10,5" MinWidth="40"
                                                                Foreground="{DynamicResource SemiColorText0}"
                                                                Value="{Binding InputObject, Mode=TwoWay}"
                                                                Watermark="浮点" />
                                                        </StackPanel>

                                                    </DataTemplate>
                                                    <DataTemplate x:Key="BoolTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <StackPanel Margin="10,0,0,0" Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    HorizontalAlignment="Right">
                                                            <TextBlock VerticalAlignment="Center"
                                                                       x:Name="textBlock"
                                                                       Text="{Binding Title}"
                                                                       Foreground="{DynamicResource SemiColorText0}" />
                                                            <ToggleSwitch Margin="10,5,10,5" MinWidth="40"
                                                                          IsChecked="{Binding InputObject, Mode=TwoWay}" />
                                                        </StackPanel>

                                                    </DataTemplate>
                                                    <DataTemplate x:Key="SearchItemTemplate"
                                                                  DataType="{x:Type customScenario:ConnectorItem}">
                                                        <StackPanel Margin="10,0,0,0" Orientation="Horizontal"
                                                                    VerticalAlignment="Center"
                                                                    HorizontalAlignment="Right">
                                                            <TextBlock VerticalAlignment="Center"
                                                                       x:Name="textBlock"
                                                                       Text="{Binding Title}"
                                                                       Foreground="{DynamicResource SemiColorText0}" />
                                                            <controls1:SearchItemShow Margin="10,5,10,5"
                                                                ToolTip.Tip="{Binding RelativeSource={RelativeSource Self},Path=OnlyKey}"
                                                                Click="SearchItemShow_OnClick"
                                                                OnlyKey="{Binding InputObject, Mode=TwoWay}" />
                                                        </StackPanel>

                                                    </DataTemplate>
                                                </pages:MyDataTemplateSelector>
                                            </ContentPresenter.DataTemplates>
                                        </ContentPresenter>

                                    </DataTemplate>


                                    <!-- Use a ContentControl to display the single element -->


                                </controls2:Node.InputConnectorTemplate>

                                <controls2:Node.OutputConnectorTemplate>
                                    <DataTemplate DataType="{x:Type customScenario:ConnectorItem}">
                                        <controls2:NodeOutput
                                            x:Name="NodeOutput"
                                            ToolTip.Tip="{Binding InputObject}"
                                            ToolTip.ShowDelay="0"
                                            VerticalAlignment="Center"
                                            IsConnected="{Binding IsConnected}"
                                            Anchor="{Binding Anchor, Mode=TwoWay}">
                                            <controls2:NodeOutput.Header>
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center"
                                                            HorizontalAlignment="Right">

                                                    <TextBlock VerticalAlignment="Center" x:Name="textBlock"
                                                               Text="{Binding Title}" />
                                                    <TextBlock VerticalAlignment="Center" FontSize="12"
                                                               Background="{DynamicResource SemiColorText0}"
                                                               Foreground="{DynamicResource SemiBackground4Color}"
                                                               Text="{Binding TypeName}">
                                                    </TextBlock>

                                                    <controls1:FontIcon FontFamily="{StaticResource FluentFont}"
                                                                        Glyph="&#xf10c;"
                                                                        ToolTip.Tip="{Binding Interfaces, Converter={StaticResource InterfacesToString}}"
                                                                        ToolTip.ShowDelay="0"
                                                                        IsVisible="{Binding Interfaces, Converter={StaticResource IfNullVisibilityHidden}}" />
                                                </StackPanel>
                                            </controls2:NodeOutput.Header>
                                            <controls2:NodeOutput.BorderBrush>
                                                <SolidColorBrush
                                                    Color="{DynamicResource SemiBlue5Color}"
                                                    Opacity="0.5" />
                                            </controls2:NodeOutput.BorderBrush>
                                        </controls2:NodeOutput>
                                    </DataTemplate>
                                </controls2:Node.OutputConnectorTemplate>

                            </controls2:Node>

                        </DataTemplate>
                    </controls2:NodifyEditor.ItemTemplate>

                </controls2:NodifyEditor>

            </Grid>
        </Border>
        <Grid Grid.Row="1" Grid.Column="2"
              Panel.ZIndex="10">
            <Border

                Padding="12"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                BorderThickness="1"
                CornerRadius="4">

                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="30"
                        Opacity="0.4"
                        Color="#202020" />
                </Border.Effect>
                <StackPanel Orientation="Horizontal">
                    <StackPanel.Resources>
                        <converter:ReverseBoolToVisibilityConverter x:Key="reverseBoolToVisibilityConverter" />
                    </StackPanel.Resources>
                    <Button ToolTip.Tip="清理未连接节点" ToolTip.ShowDelay="100" FontWeight="Normal"
                            Command="{Binding CleanUnusedNodeCommand}">
                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}" Glyph="&#xf34c;" FontSize="24" />
                    </Button>
                    <ItemsControl Grid.Column="4"
                                  IsVisible="{Binding Scenario.IsHaveInputValue,Converter={StaticResource reverseBoolToVisibilityConverter}}">
                        <Button ToolTip.Tip="运行测试" ToolTip.ShowDelay="100" FontWeight="Normal"
                                IsVisible="{Binding Scenario.IsRunning,Converter={StaticResource reverseBoolToVisibilityConverter}}"
                                Foreground="GreenYellow"
                                Command="{Binding VerifyNodeCommand}">
                            <controls1:FontIcon Foreground="GreenYellow" FontFamily="{StaticResource FluentFont}"
                                                FontSize="24"
                                                Glyph="&#xf605;" />
                        </Button>
                        <Button ToolTip.Tip="停止测试" ToolTip.ShowDelay="100" FontWeight="Normal"
                                IsVisible="{Binding Scenario.IsRunning}"

                                Command="{Binding StopCustomScenarioCommand}">
                            <controls1:FontIcon Foreground="OrangeRed" FontFamily="{StaticResource FluentFont}"
                                                FontSize="24"
                                                Glyph="&#xf72a;" />
                        </Button>
                    </ItemsControl>

                    <Button ToolTip.Tip="保存" ToolTip.ShowDelay="100" FontWeight="Normal"
                            Command="{Binding SaveCustomScenarioCommand}">
                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}" Glyph="&#xf67f;" FontSize="24" />
                    </Button>
                    <Button ToolTip.Tip="退出并保存" ToolTip.ShowDelay="100" FontWeight="Normal"
                            Command="{Binding SaveAndQuitCustomScenarioCommand}"
                            CommandParameter="{Binding $parent[u:UrsaWindow]}">
                        <controls1:FontIcon FontFamily="{StaticResource FluentFont}" Glyph="&#xea45;" FontSize="24" />
                    </Button>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>


</u:UrsaWindow>